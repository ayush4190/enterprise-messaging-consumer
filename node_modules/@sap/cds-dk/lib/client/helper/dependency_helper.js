const os = require('os');
const { execFileSync } = require('child_process');

const Logger = require('./logging');

let cachedDir;

function globalModulesDir() {
    if (!cachedDir) {
        cachedDir = execFileSync('npm', ['root', '-g'], {
            encoding: 'utf8',
            shell: os.platform() === 'win32'
        }).trim();
    }
    return cachedDir;
}

module.exports = function requireGlobal(packageId) {
    try {
        const packagePath = require.resolve(packageId, { paths: [globalModulesDir()] });
        return require(packagePath);
    } catch (error) {
        // Ignore error.
        Logger.debug(`Failed to find module '${packageId}' in ${globalModulesDir()}: ${error}`);
    }
}
